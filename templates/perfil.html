{% extends 'base.html' %}
{% set hide_navbar = False %}

{% block title %}Perfil - Educ+Invest{% endblock %}

{% block body %}
<div class="container mt-4">
    <h1 class="text-center mb-4">Meu Perfil</h1>

    <form method="POST" action="{{ url_for('perfil') }}">
        {% if session.get('tipo_usuario') == 'chefe' %}
            <div class="mb-3">
                <label for="nome" class="form-label">Nome</label>
                <input type="text" class="form-control" id="nome" name="nome" value="{{ usuario.nome }}" required>
            </div>
            <div class="mb-3">
                <label for="cargo" class="form-label">Cargo</label>
                <select class="form-select" id="cargo" name="cargo" required>
                    <option value="" disabled {% if not usuario.cargo %}selected{% endif %}>Selecione</option>
                    <option value="CEO" {% if usuario.cargo == 'CEO' %}selected{% endif %}>CEO</option>
                    <option value="Gerente" {% if usuario.cargo == 'Gerente' %}selected{% endif %}>Gerente</option>
                    <option value="Coordenador" {% if usuario.cargo == 'Coordenador' %}selected{% endif %}>Coordenador</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="nome_empresa" class="form-label">Nome da Empresa</label>
                <input type="text" class="form-control" id="nome_empresa" name="nome_empresa" value="{{ usuario.nome_empresa }}">
            </div>
            <div class="mb-3">
                <label for="email" class="form-label">E-mail</label>
                <input type="email" class="form-control" id="email" name="email" value="{{ usuario.email }}" required>
            </div>
        {% elif session.get('tipo_usuario') == 'instituicao' %}
            <div class="mb-3">
                <label for="nome_instituicao" class="form-label">Nome da Instituição</label>
                <input type="text" class="form-control" id="nome_instituicao" name="nome_instituicao" value="{{ usuario.nome_instituicao }}" required>
            </div>
            <div class="mb-3">
                <label for="endereco_instituicao" class="form-label">Endereço</label>
                <input type="text" class="form-control" id="endereco_instituicao" name="endereco_instituicao" value="{{ usuario.endereco_instituicao }}" required>
            </div>
            <div class="mb-3">
                <label for="reitor" class="form-label">Reitor</label>
                <input type="text" class="form-control" id="reitor" name="reitor" value="{{ usuario.reitor }}" required>
            </div>
            <div class="mb-3">
                <label for="infraestrutura" class="form-label">Infraestrutura</label>
                <textarea class="form-control" id="infraestrutura" name="infraestrutura" rows="3" required>{{ usuario.infraestrutura }}</textarea>
            </div>
            <div class="mb-3">
                <label for="nota_mec" class="form-label">Nota MEC</label>
                <select class="form-select" id="nota_mec" name="nota_mec" required>
                    <option value="" disabled {% if not usuario.nota_mec %}selected{% endif %}>Selecione</option>
                    {% for n in range(1, 6) %}
                        <option value="{{ n }}" {% if usuario.nota_mec == n %}selected{% endif %}>{{ n }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="mb-3">
                <label class="form-label">Cursos da Instituição</label>
                <ul class="list-group">
                    {% for curso in cursos_da_instituicao %}
                        <li class="list-group-item">{{ curso.nome }}</li>
                    {% else %}
                        <li class="list-group-item text-muted">Nenhum curso cadastrado.</li>
                    {% endfor %}
                </ul>
                <small class="text-muted">Para adicionar cursos, vá para <a href="{{ url_for('cursos') }}">Cursos</a>.</small>
            </div>
            <div class="mb-3">
                <label for="modalidades" class="form-label">Modalidades</label>
                <select class="form-select" id="modalidades" name="modalidades" required>
                    <option value="" disabled {% if not usuario.modalidades %}selected{% endif %}>Selecione</option>
                    <option value="Presencial" {% if usuario.modalidades == 'Presencial' %}selected{% endif %}>Presencial</option>
                    <option value="Hibrido" {% if usuario.modalidades == 'Hibrido' %}selected{% endif %}>Hibrido</option>
                    <option value="EAD" {% if usuario.modalidades == 'EAD' %}selected{% endif %}>EAD</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="email" class="form-label">E-mail</label>
                <input type="email" class="form-control" id="email" name="email" value="{{ usuario.email }}" required>
            </div>
        {% endif %}
        <div class="mb-3">
            <label for="senha" class="form-label">Senha</label>
            <input type="password" class="form-control" id="senha" name="senha" placeholder="Digite uma nova senha (opcional)">
        </div>
        <button type="submit" class="btn btn-primary">Atualizar</button>
    </form>
</div>

<script>
document.querySelector('form').addEventListener('submit', function(e) {
    {% if session.get('tipo_usuario') == 'chefe' %}
    const cargo = document.getElementById('cargo').value;
    if (!['CEO', 'Gerente', 'Coordenador'].includes(cargo)) {
        alert('Selecione um cargo válido.');
        e.preventDefault();
    }
    {% endif %}
});
</script>

{% endblock %}